language: cpp
git:
  depth: 1
env:
  global:
  - MODULE_NAME=query REPOSITORY_DIR="$TRAVIS_BUILD_DIR" DEPENDENCIES="$TRAVIS_BUILD_DIR/dependencies"
    GARRYSMOD_COMMON="$TRAVIS_BUILD_DIR/dependencies/garrysmod_common" SOURCE_SDK="$TRAVIS_BUILD_DIR/dependencies/sourcesdk-minimal"
    TARGET_OS="$TRAVIS_OS_NAME" COMPILER_PLATFORM=gmake BUILD_SCRIPT="$TRAVIS_BUILD_DIR/dependencies/garrysmod_common/build/ci.sh"
    GARRYSMOD_COMMON_REPOSITORY="https://github.com/danielga/garrysmod_common.git"
    PREMAKE5_EXECUTABLE=premake5
matrix:
  include:
  - os: linux
    dist: trusty
    compiler: gcc
    addons:
      apt:
        sources:
        - ubuntu-toolchain-r-test
        packages:
        - linux-libc-dev:i386
        - g++-8-multilib
        - travis
    env:
    - PREMAKE5="$TRAVIS_BUILD_DIR/dependencies/linux/premake-core/premake5" PROJECT_OS=linux
    before_install:
    - export CC=gcc-8 export CXX=g++-8
cache:
  directories:
  - "$TRAVIS_BUILD_DIR/dependencies"
  - "$TRAVIS_BUILD_DIR/projects"
install:
- travis setup releases --pro
- mkdir -p "$DEPENDENCIES"
- if [ ! -f "$GARRYSMOD_COMMON/premake5.lua" ]; then echo "garrysmod_common directory
  is empty, doing git clone of the remote repo"; git clone --recursive "$GARRYSMOD_COMMON_REPOSITORY"
  "$GARRYSMOD_COMMON"; else echo "garrysmod_common directory is good, pulling any
  latest changes"; git -C "$GARRYSMOD_COMMON" pull; git -C "$GARRYSMOD_COMMON" submodule
  update --init --recursive; fi
script: "$BUILD_SCRIPT"
deploy:
  provider: releases
  api_key:
    secure: "ZQWtQ1fTo0Y9MD9TCA0ezyrJe34NY17ZUj/5vVYmKg5S+s7IQEDaN+HuedqY7SIRnpxmnxI4DEkL4bnGeKybePfVNsVk937knvftgIzl6YZlry8jHe3oEpu5bTDT9WaFk+IxLGO3g5NXpxPmmnWZoKkjlRCzqeY5TtFj2wvE/xzUWJsF6Glbr7GYKttmjtKqoJJNhHqWG6ANLSWOatv07W0ztdvddgAfKzNMxKS8s5sc+qUhF+1vndtdatFia5XuVSjYddxenNPAQjSSQp2MC7RcmSVvXrahP1JGZOilqCl8tkRz/wHHAnwGJb9/Bh/iYcz6XuTFS+PelN64Uj9SFhUUla5StcyBiZK++6dyVO7gTRgtVPruA9ylpEq2apyMWpM2dYnfGRZeIEm30+qRsz0gpn9En7BYBfgnzyuR0oVwKSxCLZj7eq7TfFOO819qNxqOQPBZNIDldGuirwdT1EQCnN37YxGH83hCSk0j0CtNmHpVcRW6djRd7wLo0VbNqTwMs1ypLrsBw6K/8+o27p89airC9TN8iD7UhV53S9r7xJSrFrFv1yLblbpyp9/xNyJ/s1hcRSZqvq/W2e8AEztZVE117D5ngyls7TSiN7NdvLR+vPhBUv1j8pMsf2+Pyn6cM1AUKQoY5Y/lnJSFYQiDXOcaIqYINTdSDB94/sk="
  file: "${TRAVIS_BUILD_DIR}/projects/${PROJECT_OS}/${COMPILER_PLATFORM}/release/gmsv_${MODULE_NAME}_${TARGET_OS}.dll"
  on:
    repo: nbvnbv/gmsv_query
